instructions:
  # R-Type Instructions
  - name: SLL
    desc_short: Shifts the value in $Rt left by Sa logically, storing the result in $Rd
    desc_long: >
      insert long description here if you so please
    compile:
      format: [Rd, Rt, Shamt]
    runtime:
      type: R
      funct: 0x00
      reads: [Rt]

  - name: SRL
    desc_short: Shifts the value in $Rt right by Sa logically, storing the result in $Rd
    compile:
      format: [Rd, Rt, Shamt]
    runtime:
      type: R
      funct: 0x02
      reads: [Rt]

  - name: SRA
    desc_short: Shifts the value in $Rt right by Sa arithmetically, storing the result in $Rd
    compile:
      format: [Rd, Rt, Shamt]
    runtime:
      type: R
      funct: 0x03
      reads: [Rt]

  - name: SLLV
    desc_short: Shifts the value in $Rt left by the value in $Rs logically, storing the result in $Rd
    compile:
      format: [Rd, Rt, Rs]
    runtime:
      type: R
      funct: 0x04
      reads: [Rt, Rs]

  - name: SRLV
    desc_short: Shifts the value in $Rt right by the value in $Rs logically, storing the result in $Rd
    compile:
      format: [Rd, Rt, Rs]
    runtime:
      type: R
      funct: 0x06
      reads: [Rt, Rs]

  - name: SRAV
    desc_short: Shifts the value in $Rt right by the value in $Rs arithmetically, storing the result in $Rd
    compile:
      format: [Rd, Rt, Rs]
    runtime:
      type: R
      funct: 0x07
      reads: [Rt, Rs]


  - name: JR
    desc_short: Jumps to the address stored in the register $Rs
    compile:
      format: [Rs]
    runtime:
      type: R
      funct: 0x08
      reads: [Rs]

  - name: JALR
    desc_short: Jump-and-links to the address stored in the register $Rs
    compile:
      format: [Rs]
    runtime:
      type: R
      funct: 0x09
      reads: [Rs]


  - name: SYSCALL
    desc_short: Causes a system-call interrupt
    compile:
      format: []
    runtime:
      type: R
      funct: 0x0C
      reads: []

  - name: BREAK
    desc_short: Causes a break interrupt
    compile:
      format: []
    runtime:
      type: R
      funct: 0x0D
      reads: []


  - name: MFHI
    desc_short: Copies the value from the HI register to $Rd
    compile:
      format: [Rd]
    runtime:
      type: R
      funct: 0x10
      reads: []

  - name: MTHI
    desc_short: Copies the value from $Rs to the HI register
    compile:
      format: [Rs]
    runtime:
      type: R
      funct: 0x11
      reads: [Rs]

  - name: MFLO
    desc_short: Copies the value from the LO register to $Rd
    compile:
      format: [Rd]
    runtime:
      type: R
      funct: 0x12
      reads: []

  - name: MTLO
    desc_short: Copies the value from $Rs to the LO register
    compile:
      format: [Rs]
    runtime:
      type: R
      funct: 0x13
      reads: [Rs]

  - name: MULT
    desc_short: Multiplies the values in $Rs and $Rt, storing the result in the HI and LO registers
    compile:
      format: [Rs, Rt]
    runtime:
      type: R
      funct: 0x18
      reads: [Rs, Rt]

  - name: MULTU
    desc_short: Multiplies the values in $Rs and $Rt, storing the result in the HI and LO registers, unsigned
    compile:
      format: [Rs, Rt]
    runtime:
      type: R
      funct: 0x19
      reads: [Rs, Rt]

  - name: DIV
    desc_short: Divides the values in $Rs and $Rt, storing the $Rs / $Rt in HI, and $Rs % $Rt in LO
    compile:
      format: [Rs, Rt]
    runtime:
      type: R
      funct: 0x1A
      reads: [Rs, Rt]

  - name: DIVU
    desc_short: Divides the values in $Rs and $Rt, storing the $Rs / $Rt in HI, and $Rs % $Rt in LO, unsigned
    compile:
      format: [Rs, Rt]
    runtime:
      type: R
      funct: 0x1B
      reads: [Rs, Rt]


  - name: ADD
    desc_short: todo
    compile:
      format: [Rd, Rs, Rt]
    runtime:
      type: R
      funct: 0x20
      reads: [Rs, Rt]

  - name: ADDU
    desc_short: todo
    compile:
      format: [Rd, Rs, Rt]
    runtime:
      type: R
      funct: 0x21
      reads: [Rs, Rt]

  - name: SUB
    desc_short: todo
    compile:
      format: [Rd, Rs, Rt]
    runtime:
      type: R
      funct: 0x22
      reads: [Rs, Rt]

  - name: SUBU
    desc_short: todo
    compile:
      format: [Rd, Rs, Rt]
    runtime:
      type: R
      funct: 0x23
      reads: [Rs, Rt]

  - name: AND
    desc_short: todo
    compile:
      format: [Rd, Rs, Rt]
    runtime:
      type: R
      funct: 0x24
      reads: [Rs, Rt]

  - name: OR
    desc_short: todo
    compile:
      format: [Rd, Rs, Rt]
    runtime:
      type: R
      funct: 0x25
      reads: [Rs, Rt]

  - name: XOR
    desc_short: todo
    compile:
      format: [Rd, Rs, Rt]
    runtime:
      type: R
      funct: 0x26
      reads: [Rs, Rt]

  - name: NOR
    desc_short: todo
    compile:
      format: [Rd, Rs, Rt]
    runtime:
      type: R
      funct: 0x27
      reads: [Rs, Rt]


  - name: SLT
    desc_short: Set $Rd to 1 if $Rs < $Rt, otherwise set $Rd to 0, unsigned
    compile:
      format: [Rd, Rs, Rt]
    runtime:
      type: R
      funct: 0x2A
      reads: [Rs, Rt]

  - name: SLTU
    desc_short: Set $Rd to 1 if $Rs < $Rt, otherwise set $Rd to 0, unsigned
    compile:
      format: [Rd, Rs, Rt]
    runtime:
      type: R
      funct: 0x2B
      reads: [Rs, Rt]
      
  # I-Type instructions

  - name: BLTZ
    desc_short: Branch to the immediate address if the value in $Rs < 0
    compile:
      format: [Rs, I16]
      relative_label: true
    runtime:
      type: I
      opcode: 0x01
      rt: 0x00
      reads: [Rs]

  - name: BGEZ
    desc_short: Branch to the immediate address if the value in $Rs >= 0
    compile:
      format: [Rs, I16]
      relative_label: true
    runtime:
      type: I
      opcode: 0x01
      rt: 0x01
      reads: [Rs]

  - name: BEQ
    desc_short: Branch to the immediate address if the values in $Rs == $Rt
    compile:
      format: [Rs, Rt, I16]
      relative_label: true
    runtime:
      type: I
      opcode: 0x04
      reads: [Rs, Rt]

  - name: BNE
    desc_short: Branch to the immediate address if the values in $Rs != $Rt
    compile:
      format: [Rs, Rt, I16]
      relative_label: true
    runtime:
      type: I
      opcode: 0x05
      reads: [Rs, Rt]

  - name: BLEZ
    desc_short: Branch to the immediate address if the value in $Rs <= 0
    compile:
      format: [Rs, I16]
      relative_label: true
    runtime:
      type: I
      opcode: 0x06
      reads: [Rs]

  - name: BGTZ
    desc_short: Branch to the immediate address if the value in $Rs > 0
    compile:
      format: [Rs, I16]
      relative_label: true
    runtime:
      type: I
      opcode: 0x07
      reads: [Rs]


  - name: ADDI
    desc_short: Adds an immediate value to the value in $Rs, stores result in $Rt
    compile:
      format: [Rt, Rs, I16]
    runtime:
      type: I
      opcode: 0x08
      reads: [Rs]

  - name: ADDIU
    desc_short: Adds an immediate value to the value in $Rs, stores result in $Rt, unsigned
    compile:
      format: [Rt, Rs, I16]
    runtime:
      type: I
      opcode: 0x09
      reads: [Rs]


  - name: SLTI
    desc_short: Sets $Rt to 1 if the value in $Rs is less than the immediate value, otherwise sets $Rt to 0
    compile:
      format: [Rt, Rs, I16]
    runtime:
      type: I
      opcode: 0x0A
      reads: [Rs]

  - name: SLTIU
    desc_short: Sets $Rt to 1 if the value in $Rs is less than the immediate value, otherwise sets $Rt to 0, unsigned
    compile:
      format: [Rt, Rs, I16]
    runtime:
      type: I
      opcode: 0x0B
      reads: [Rs]


  - name: ANDI
    desc_short: Bitwise and of the value in $Rs and the immediate value, stores the result in $Rt
    compile:
      format: [Rt, Rs, U16]
    runtime:
      type: I
      opcode: 0x0C
      reads: [Rs]

  - name: ORI
    desc_short: Bitwise or of the value in $Rs and the immediate value, stores the result in $Rt
    compile:
      format: [Rt, Rs, U16]
    runtime:
      type: I
      opcode: 0x0D
      reads: [Rs]

  - name: XORI
    desc_short: Bitwise xor of the value in $Rs and the immediate value, stores the result in $Rt
    compile:
      format: [Rt, Rs, U16]
    runtime:
      type: I
      opcode: 0x0E
      reads: [Rs]

  - name: LUI
    desc_short: Load the immediate value into the upper 16 bits of $Rt
    compile:
      format: [Rt, U16]
    runtime:
      type: I
      opcode: 0x0F
      reads: []


  - name: LB
    desc_short: Load one byte at the immediate address + $Rs into $Rt
    compile:
      format: [Rt, OffRs]
    runtime:
      type: I
      opcode: 0x20
      reads: [OffRs]

  - name: LH
    desc_short: Load two bytes at the immediate address + $Rs into $Rt
    compile:
      format: [Rt, OffRs]
    runtime:
      type: I
      opcode: 0x21
      reads: [OffRs]

  - name: LW
    desc_short: Load four bytes at the immediate address + $Rs into $Rt
    compile:
      format: [Rt, OffRs]
    runtime:
      type: I
      opcode: 0x23
      reads: [OffRs]

  - name: LBU
    desc_short: Load one byte at the immediate address + $Rs into $Rt, don't sign extend
    compile:
      format: [Rt, OffRs]
    runtime:
      type: I
      opcode: 0x24
      reads: [OffRs]

  - name: LHU
    desc_short: Load two bytes at the immediate address + $Rs into $Rt, don't sign extend
    compile:
      format: [Rt, OffRs]
    runtime:
      type: I
      opcode: 0x25
      reads: [OffRs]

  - name: SB
    desc_short: Store one byte from $Rt into the immediate address + $Rs
    compile:
      format: [Rt, OffRs]
    runtime:
      type: I
      opcode: 0x28
      reads: [Rt]

  - name: SH
    desc_short: Store two bytes from $Rt into the immediate address + $Rs
    compile:
      format: [Rt, OffRs]
    runtime:
      type: I
      opcode: 0x29
      reads: [Rt]

  - name: SW
    desc_short: Store four bytes from $Rt into the immediate address + $Rs
    compile:
      format: [Rt, OffRs]
    runtime:
      type: I
      opcode: 0x2B
      reads: [Rt]

  - name: LWC1
    desc_short: Load a word from the immediate address + $Rs into $Rt (floating point register) 
    compile:
      format: [Rt, OffRs]
    runtime:
      type: I
      opcode: 0x31
      reads: [OffRs]

  - name: SWC1
    desc_short: Store a word from $Rt (floating point register) into the immediate address + $Rs 
    compile:
      format: [Rt, OffRs]
    runtime:
      type: I
      opcode: 0x39
      reads: [Rt]

  # J-Type Instructions
  - name: J
    desc_short: Jump to the immediate address 
    compile:
      format: [J]
    runtime:
      type: J
      opcode: 0x02
      reads: []

  - name: JAL
    desc_short: Jump-and-link to the immediate address 
    compile:
      format: [J]
    runtime:
      type: J
      opcode: 0x03
      reads: []


pseudoinstructions:
# R-Type Instructions
  - name: SLL
    compile:
      format: [Rd, Rt, Shamt]
    expand:
      - inst: SLL
        data: [$Rd, $Rt, $Shamt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rt
          default: $Rd
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SRL
    compile:
      format: [Rd, Rt, Shamt]
    expand:
      - inst: SRL
        data: [$Rd, $Rt, $Shamt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rt
          default: $Rd
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SRA
    compile:
      format: [Rd, Rt, Shamt]
    expand:
      - inst: SRA
        data: [$Rd, $Rt, $Shamt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rt
          default: $Rd
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SLLV
    compile:
      format: [Rd, Rt, Rs]
    expand:
      - inst: SLLV
        data: [$Rd, $Rt, $Rs]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rt
          default: $Rd
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SRLV
    compile:
      format: [Rd, Rt, Rs]
    expand:
      - inst: SRLV
        data: [$Rd, $Rt, $Rs]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rt
          default: $Rd
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SRAV
    compile:
      format: [Rd, Rt, Rs]
    expand:
      - inst: SRAV
        data: [$Rd, $Rt, $Rs]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rt
          default: $Rd
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: JR
    compile:
      format: [Rs]
    expand:
      - inst: JR
        data: [$Rs]
    only_derive: true

  - name: JALR
    compile:
      format: [Rs]
    expand:
      - inst: JALR
        data: [$Rs]
    only_derive: true

  - name: SYSCALL
    compile:
      format: []
    expand:
      - inst: SYSCALL
        data: []
    only_derive: true

  - name: BREAK
    compile:
      format: []
    expand:
      - inst: BREAK
        data: []
    only_derive: true


  - name: MFHI
    compile:
      format: [Rd]
    expand:
      - inst: MFHI
        data: [$Rd]
    only_derive: true

  - name: MTHI
    compile:
      format: [Rs]
    expand:
      - inst: MTHI
        data: [$Rs]
    only_derive: true

  - name: MFLO
    compile:
      format: [Rd]
    expand:
      - inst: MFLO
        data: [$Rd]
    only_derive: true

  - name: MTLO
    compile:
      format: [Rs]
    expand:
      - inst: MTLO
        data: [$Rs]
    only_derive: true

  - name: MULT
    compile:
      format: [Rs, Rt]
    expand:
      - inst: MULT
        data: [$Rs, $Rt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rt
          default: $Rs

  - name: MULTU
    compile:
      format: [Rs, Rt]
    expand:
      - inst: MULTU
        data: [$Rs, $Rt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rt
          default: $Rs

  - name: DIV
    compile:
      format: [Rs, Rt]
    expand:
      - inst: DIV
        data: [$Rs, $Rt]
    only_derive: true

  - name: DIVU
    compile:
      format: [Rs, Rt]
    expand:
      - inst: DIVU
        data: [$Rs, $Rt]
    only_derive: true

  - name: ADD
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: ADD
        data: [$Rd, $Rs, $Rt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: ADDU
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: ADDU
        data: [$Rd, $Rs, $Rt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SUB
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: SUB
        data: [$Rd, $Rs, $Rt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SUBU
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: SUBU
        data: [$Rd, $Rs, $Rt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: AND
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: AND
        data: [$Rd, $Rs, $Rt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: OR
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: OR
        data: [$Rd, $Rs, $Rt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: XOR
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: XOR
        data: [$Rd, $Rs, $Rt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: NOR
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: NOR
        data: [$Rd, $Rs, $Rt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SLT
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: SLT
        data: [$Rd, $Rs, $Rt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SLTU
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: SLTU
        data: [$Rd, $Rs, $Rt]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SLE
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: SLT
        data: [$Rd, $Rs, $Rt]
      - inst: BNE
        data: [$Rs, $Rt, 2]
      - inst: ORI
        data: [$Rd, $0, 1]
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SLEU
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: SLTU
        data: [$Rd, $Rs, $Rt]
      - inst: BNE
        data: [$Rs, $Rt, 2]
      - inst: ORI
        data: [$Rd, $0, 1]
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SGT
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: SLT
        data: [$Rd, $Rt, $Rs]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SGTU
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: SLTU
        data: [$Rd, $Rt, $Rs]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SGE
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: SLT
        data: [$Rd, $Rs, $Rt]
      - inst: ORI
        data: [$At, $0, 1]
      - inst: SUB
        data: [$Rd, $At, $Rd]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SGEU
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: SLTU
        data: [$Rd, $Rs, $Rt]
      - inst: ORI
        data: [$At, $0, 1]
      - inst: SUB
        data: [$Rd, $At, $Rd]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SEQ
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: ORI
        data: [$Rd, $0, 1]
      - inst: BEQ
        data: [$Rs, $Rt, 2]
      - inst: ORI
        data: [$Rd, $0, 0]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: SNE
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: ORI
        data: [$Rd, $0, 1]
      - inst: BNE
        data: [$Rs, $Rt, 2]
      - inst: ORI
        data: [$Rd, $0, 0]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      
  # I-Type instructions

  - name: BLTZ
    compile:
      format: [Rs, I16]
      relative_label: true
    expand:
      - inst: BLTZ
        data: [$Rs, $I16]
    only_derive: true

  - name: BGEZ
    compile:
      format: [Rs, I16]
      relative_label: true
    expand:
      - inst: BGEZ
        data: [$Rs, $I16]
    only_derive: true

  - name: BEQ
    compile:
      format: [Rs, Rt, I16]
      relative_label: true
    expand:
      - inst: BEQ
        data: [$Rs, $Rt, $I16]
    only_derive: true
    derives:
      - Imm2Reg:
          register: Rt
          imm_types: [U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [U16, I32, U32]
          sign_extend: true

  - name: BNE
    compile:
      format: [Rs, Rt, I16]
      relative_label: true
    expand:
      - inst: BNE
        data: [$Rs, $Rt, $I16]
    only_derive: true
    derives:
      - Imm2Reg:
          register: Rt
          imm_types: [U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [U16, I32, U32]
          sign_extend: true

  - name: BLEZ
    compile:
      format: [Rs, I16]
      relative_label: true
    expand:
      - inst: BLEZ
        data: [$Rs, $I16]
    only_derive: true

  - name: BGTZ
    compile:
      format: [Rs, I16]
      relative_label: true
    expand:
      - inst: BGTZ
        data: [$Rs, $I16]
    only_derive: true

  - name: ADDI
    compile:
      format: [Rt, Rs, I16]
    expand:
      - inst: ADDI
        data: [$Rt, $Rs, $I16]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rt

  - name: ADDI
    compile:
      format: [Rt, Rs, Rx]
    expand:
      - inst: ADD
        data: [$Rt, $Rs, $Rx]
    only_derive: true
    derives:
      - Imm2Reg:
          register: Rx
          imm_types: [U16, I32, U32]
          derives:
            - DefaultValue:
                value: Rs
                default: $Rt

  - name: ADDIU
    compile:
      format: [Rt, Rs, I16]
    expand:
      - inst: ADDIU
        data: [$Rt, $Rs, $I16]
    only_derive: true
    derives:
      - DefaultValue:
          value: Rs
          default: $Rt

  - name: ADDIU
    compile:
      format: [Rt, Rs, Rx]
    expand:
      - inst: ADDU
        data: [$Rt, $Rs, $Rx]
    only_derive: true
    derives:
      - Imm2Reg:
          register: Rx
          imm_types: [U16, I32, U32]
          derives:
            - DefaultValue:
                value: Rs
                default: $Rt

  - name: SLTI
    compile:
      format: [Rt, Rs, I16]
    expand:
      - inst: SLTI
        data: [$Rt, $Rs, $I16]
    only_derive: true

  - name: SLTI
    compile:
      format: [Rt, Rs, Rx]
    expand:
      - inst: SLT
        data: [$Rt, $Rs, $Rx]
    only_derive: true
    derives:
      - Imm2Reg:
          register: Rx
          imm_types: [U16, I32, U32]

  - name: SLTIU
    compile:
      format: [Rt, Rs, I16]
    expand:
      - inst: SLTIU
        data: [$Rt, $Rs, $I16]
    only_derive: true

  - name: SLTIU
    compile:
      format: [Rt, Rs, Rx]
    expand:
      - inst: SLTU
        data: [$Rt, $Rs, $Rx]
    only_derive: true
    derives:
      - Imm2Reg:
          register: Rx
          imm_types: [U16, I32, U32]

  - name: ANDI
    compile:
      format: [Rt, Rs, U16]
    expand:
      - inst: ANDI
        data: [$Rt, $Rs, $U16]
    only_derive: true

  - name: ANDI
    compile:
      format: [Rt, Rs, Rx]
    expand:
      - inst: AND
        data: [$Rt, $Rs, $Rx]
    only_derive: true
    derives:
      - Imm2Reg:
          register: Rx
          imm_types: [I32, U32]

  - name: ORI
    compile:
      format: [Rt, Rs, U16]
    expand:
      - inst: ORI
        data: [$Rt, $Rs, $U16]
    only_derive: true

  - name: ORI
    compile:
      format: [Rt, Rs, Rx]
    expand:
      - inst: ORI
        data: [$Rt, $Rs, $Rx]
    only_derive: true
    derives:
      - Imm2Reg:
          register: Rx
          imm_types: [I32, U32]

  - name: XORI
    compile:
      format: [Rt, Rs, U16]
    expand:
      - inst: XORI
        data: [$Rt, $Rs, $U16]
    only_derive: true

  - name: XORI
    compile:
      format: [Rt, Rs, Rx]
    expand:
      - inst: XOR
        data: [$Rt, $Rs, $Rx]
    only_derive: true
    derives:
      - Imm2Reg:
          register: Rx
          imm_types: [I32, U32]

  - name: LUI
    compile:
      format: [Rt, U16]
    expand:
      - inst: LUI
        data: [$Rt, $U16]
    only_derive: true

  - name: LB
    compile:
      format: [Rt, U32]
    expand:
      - inst: LUI
        data: [$At, $U32uHi]
      - inst: ORI
        data: [$At, $At, $U32uLo]
      - inst: LB
        data: [$Rt, ($At)]

  - name: LB
    compile:
      format: [Rt, Off32Rs]
    expand:
      - inst: LUI
        data: [$At, $Off32uHi]
      - inst: ORI
        data: [$At, $At, $Off32uLo]
      - inst: ADDU
        data: [$At, $At, $Rs]
      - inst: LB
        data: [$Rt, ($At)]

  - name: LH
    compile:
      format: [Rt, U32]
    expand:
      - inst: LUI
        data: [$At, $U32uHi]
      - inst: ORI
        data: [$At, $At, $U32uLo]
      - inst: LH
        data: [$Rt, ($At)]

  - name: LH
    compile:
      format: [Rt, Off32Rs]
    expand:
      - inst: LUI
        data: [$At, $Off32uHi]
      - inst: ORI
        data: [$At, $At, $Off32uLo]
      - inst: ADDU
        data: [$At, $At, $Rs]
      - inst: LH
        data: [$Rt, ($At)]

  - name: LW
    compile:
      format: [Rt, U32]
    expand:
      - inst: LUI
        data: [$At, $U32uHi]
      - inst: ORI
        data: [$At, $At, $U32uLo]
      - inst: LW
        data: [$Rt, ($At)]

  - name: LW
    compile:
      format: [Rt, Off32Rs]
    expand:
      - inst: LUI
        data: [$At, $Off32uHi]
      - inst: ORI
        data: [$At, $At, $Off32uLo]
      - inst: ADDU
        data: [$At, $At, $Rs]
      - inst: LW
        data: [$Rt, ($At)]

  - name: LBU
    compile:
      format: [Rt, U32]
    expand:
      - inst: LUI
        data: [$At, $U32uHi]
      - inst: ORI
        data: [$At, $At, $U32uLo]
      - inst: LBU
        data: [$Rt, ($At)]

  - name: LBU
    compile:
      format: [Rt, Off32Rs]
    expand:
      - inst: LUI
        data: [$At, $Off32uHi]
      - inst: ORI
        data: [$At, $At, $Off32uLo]
      - inst: ADDU
        data: [$At, $At, $Rs]
      - inst: LBU
        data: [$Rt, ($At)]

  - name: LHU
    compile:
      format: [Rt, U32]
    expand:
      - inst: LUI
        data: [$At, $U32uHi]
      - inst: ORI
        data: [$At, $At, $U32uLo]
      - inst: LHU
        data: [$Rt, ($At)]

  - name: LHU
    compile:
      format: [Rt, Off32Rs]
    expand:
      - inst: LUI
        data: [$At, $Off32uHi]
      - inst: ORI
        data: [$At, $At, $Off32uLo]
      - inst: ADDU
        data: [$At, $At, $Rs]
      - inst: LHU
        data: [$Rt, ($At)]

  - name: SB
    compile:
      format: [Rt, U32]
    expand:
      - inst: LUI
        data: [$At, $U32uHi]
      - inst: ORI
        data: [$At, $At, $U32uLo]
      - inst: SB
        data: [$Rt, ($At)]

  - name: SB
    compile:
      format: [Rt, Off32Rs]
    expand:
      - inst: LUI
        data: [$At, $Off32uHi]
      - inst: ORI
        data: [$At, $At, $Off32uLo]
      - inst: ADDU
        data: [$At, $At, $Rs]
      - inst: SB
        data: [$Rt, ($At)]

  - name: SH
    compile:
      format: [Rt, U32]
    expand:
      - inst: LUI
        data: [$At, $U32uHi]
      - inst: ORI
        data: [$At, $At, $U32uLo]
      - inst: SH
        data: [$Rt, ($At)]

  - name: SH
    compile:
      format: [Rt, Off32Rs]
    expand:
      - inst: LUI
        data: [$At, $Off32uHi]
      - inst: ORI
        data: [$At, $At, $Off32uLo]
      - inst: ADDU
        data: [$At, $At, $Rs]
      - inst: SH
        data: [$Rt, ($At)]

  - name: SW
    compile:
      format: [Rt, U32]
    expand:
      - inst: LUI
        data: [$At, $U32uHi]
      - inst: ORI
        data: [$At, $At, $U32uLo]
      - inst: SW
        data: [$Rt, ($At)]

  - name: SW
    compile:
      format: [Rt, Off32Rs]
    expand:
      - inst: LUI
        data: [$At, $Off32uHi]
      - inst: ORI
        data: [$At, $At, $Off32uLo]
      - inst: ADDU
        data: [$At, $At, $Rs]
      - inst: SW
        data: [$Rt, ($At)]

  - name: LWC1
    compile:
      format: [Rt, OffRs]
    expand:
      - inst: LWC1
        data: [$Rt, $OffRs]
    only_derive: true

  - name: SWC1
    compile:
      format: [Rt, OffRs]
    expand:
      - inst: SWC1
        data: [$Rt, $OffRs]
    only_derive: true

  # J-Type Instructions
  - name: J
    compile:
      format: [J]
    expand:
      - inst: J
        data: [$J]
    only_derive: true

  - name: JAL
    compile:
      format: [J]
    expand:
      - inst: JAL
        data: [$J]
    only_derive: true
  
  # True pseudo-instructions
  - name: LI
    compile:
      format: [Rs, Rx]
    expand: []
    only_derive: true
    derives:
      - Imm2Reg:
          register: Rx
          sign_extend: true
          imm_types: [I16, U16, I32, U32]
          imm_register: 'Rs'

  - name: LA
    compile:
      format: [Rs, Rx]
    expand: []
    only_derive: true
    derives:
      - Imm2Reg:
          register: Rx
          sign_extend: true
          imm_types: [I32, U32]
          imm_register: 'Rs'

  - name: LA
    compile:
      format: [Rs, OffRt]
    expand:
      - inst: ADDIU
        data: [$Rs, $Rt, $Off]

  - name: LA
    compile:
      format: [Rs, Off32Rt]
    expand:
      - inst: LUI
        data: [$Rs, $Off32uHi]
      - inst: ORI
        data: [$Rs, $Rs, $Off32uLo]
      - inst: ADDU
        data: [$Rs, $Rs, $Rt]

  - name: NOP
    desc_short: No-Operation - doesn't do anything
    compile:
      format: []
    expand:
      - inst: SLL
        data: [$0, $0, 0]

  - name: MOVE
    desc_short: Copy the value from $Rs into $Rd
    compile:
      format: [Rd, Rs]
    expand:
      - inst: ADDU
        data: [$Rd, $0, $Rs]

  - name: NEG
    desc_short: Flip all the bits in $Rs, store result in $Rd
    compile:
      format: [Rd, Rs]
    expand:
      - inst: SUB
        data: [$Rd, $0, $Rs]
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd

  - name: NEGU
    desc_short: Flip all the bits in $Rs, store result in $Rd
    compile:
      format: [Rd, Rs]
    expand:
      - inst: SUBU
        data: [$Rd, $0, $Rs]
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd

  - name: NOT
    desc_short: $Rd = ! $Rs
    compile:
      format: [Rd, Rs]
    expand:
      - inst: NOR
        data: [$Rd, $0, $Rs]
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd

  - name: MUL
    desc_short: $Rd = $Rs * $Rt
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: MULT
        data: [$Rs, $Rt]
      - inst: MFLO
        data: [$Rd]
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: DIV
    desc_short: $Rd = $Rs / $Rt
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: DIV
        data: [$Rs, $Rt]
      - inst: MFLO
        data: [$Rd]
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: REM
    desc_short: Store the remainder of $Rs / $Rt into $Rd
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: DIV
        data: [$Rs, $Rt]
      - inst: MFHI
        data: [$Rd]
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [I16, U16, I32, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [I16, U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [I16, U16, I32, U32]
          sign_extend: true

  - name: REMU
    desc_short: Store the remainder of $Rs / $Rt (unsigned) into $Rd
    compile:
      format: [Rd, Rs, Rt]
    expand:
      - inst: DIVU
        data: [$Rs, $Rt]
      - inst: MFHI
        data: [$Rd]
    derives:
      - DefaultValue:
          value: Rs
          default: $Rd
          derives:
            - Imm2Reg:
                register: Rt
                imm_types: [U16, U32]
                sign_extend: true
      - Imm2Reg:
          register: Rt
          imm_types: [U16, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [U16, U32]
          sign_extend: true

  - name: ABS
    desc_short: $Rs = |$Rt|
    compile:
      format: [Rs, Rt]
    expand:
      - inst: BGEZ
        data: [$Rt, 2]
      - inst: SUB
        data: [$Rs, $0, $Rt]
    derives:
      - DefaultValue:
          value: Rt
          default: $Rs

  - name: PUSH
    desc_short: Push $Rs to the top of the stack
    compile:
      format: [Rs]
    expand:
      - inst: ADDIU
        data: [$sp, $sp, -4]
      - inst: SW
        data: [$Rs, ($sp)]

  - name: POP
    desc_short: Pop the top of the stack into $Rd
    compile:
      format: [Rd]
    expand:
      - inst: LW
        data: [$Rd, ($sp)]
      - inst: ADDIU
        data: [$sp, $sp, 4]

  - name: B
    desc_short: Branch unconditionally
    compile:
      format: [I16]
      relative_label: true
    expand:
      - inst: BGEZ
        data: [$0, $I16]

  - name: BEQZ
    desc_short: Branch if $Rs == 0
    compile:
      format: [Rs, I16]
      relative_label: true
    expand:
      - inst: BEQ
        data: [$Rs, $0, $I16]

  - name: BNEZ
    desc_short: Branch if $Rs != 0
    compile:
      format: [Rs, I16]
      relative_label: true
    expand:
      - inst: BNE
        data: [$Rs, $0, $I16]

  - name: BGE
    desc_short: Branch if $Rs >= $Rt
    compile:
      format: [Rs, Rt, I16]
      relative_label: true
    expand:
      - inst: SLT
        data: [$At, $Rs, $Rt]
      - inst: BEQ
        data: [$At, $0, $I16]
    derives:
      - Imm2Reg:
          register: Rt
          imm_types: [U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [U16, I32, U32]
          sign_extend: true

  - name: BGEU
    desc_short: Branch if $Rs >= $Rt unsigned
    compile:
      format: [Rs, Rt, I16]
      relative_label: true
    expand:
      - inst: SLTU
        data: [$At, $Rs, $Rt]
      - inst: BEQ
        data: [$At, $0, $I16]
    derives:
      - Imm2Reg:
          register: Rt
          imm_types: [U16, U32]
      - Imm2Reg:
          register: Rs
          imm_types: [U16, U32]

  - name: BLT
    desc_short: Branch if $Rs < $Rt
    compile:
      format: [Rs, Rt, I16]
      relative_label: true
    expand:
      - inst: SLT
        data: [$At, $Rs, $Rt]
      - inst: BNE
        data: [$At, $0, $I16]
    derives:
      - Imm2Reg:
          register: Rt
          imm_types: [U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [U16, I32, U32]
          sign_extend: true

  - name: BLTU
    desc_short: Branch if $Rs < $Rt unsigned
    compile:
      format: [Rs, Rt, I16]
      relative_label: true
    expand:
      - inst: SLTU
        data: [$At, $Rs, $Rt]
      - inst: BNE
        data: [$At, $0, $I16]
    derives:
      - Imm2Reg:
          register: Rt
          imm_types: [U16, U32]
      - Imm2Reg:
          register: Rs
          imm_types: [U16, U32]

  - name: BLE
    desc_short: Branch if $Rs <= $Rt
    compile:
      format: [Rs, Rt, I16]
      relative_label: true
    expand:
      - inst: SLT
        data: [$At, $Rt, $Rs]
      - inst: BEQ
        data: [$At, $0, $I16]
    derives:
      - Imm2Reg:
          register: Rt
          imm_types: [U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [U16, I32, U32]
          sign_extend: true

  - name: BLEU
    desc_short: Branch if $Rs <= $Rt
    compile:
      format: [Rs, Rt, I16]
      relative_label: true
    expand:
      - inst: SLTU
        data: [$At, $Rt, $Rs]
      - inst: BEQ
        data: [$At, $0, $I16]
    derives:
      - Imm2Reg:
          register: Rt
          imm_types: [U16, U32]
      - Imm2Reg:
          register: Rs
          imm_types: [U16, U32]

  - name: BGT
    desc_short: Branch if $Rs > $Rt
    compile:
      format: [Rs, Rt, I16]
      relative_label: true
    expand:
      - inst: SLT
        data: [$At, $Rt, $Rs]
      - inst: BNE
        data: [$At, $0, $I16]
    derives:
      - Imm2Reg:
          register: Rt
          imm_types: [U16, I32, U32]
          sign_extend: true
      - Imm2Reg:
          register: Rs
          imm_types: [U16, I32, U32]
          sign_extend: true

  - name: BGTU
    desc_short: Branch if $Rs > $Rt unsigned
    compile:
      format: [Rs, Rt, I16]
      relative_label: true
    expand:
      - inst: SLTU
        data: [$At, $Rt, $Rs]
      - inst: BNE
        data: [$At, $0, $I16]
    derives:
      - Imm2Reg:
          register: Rt
          imm_types: [U16, U32]
      - Imm2Reg:
          register: Rs
          imm_types: [U16, U32]
